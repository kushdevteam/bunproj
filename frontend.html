<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proxima Solana Bundler</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0a0a0a; color: #fff; min-height: 100vh; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 40px; }
        .title { font-size: 2.5rem; font-weight: bold; color: #00ff88; margin-bottom: 10px; }
        .subtitle { color: #888; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 40px; }
        @media (max-width: 768px) { .grid { grid-template-columns: 1fr; } }
        .card { background: #1a1a1a; border: 1px solid #333; border-radius: 12px; padding: 24px; }
        .card h3 { color: #00ff88; margin-bottom: 16px; font-size: 1.2rem; }
        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; margin-bottom: 6px; color: #ccc; font-size: 0.9rem; }
        .form-group input, .form-group select { width: 100%; padding: 10px; background: #2a2a2a; border: 1px solid #444; border-radius: 6px; color: #fff; font-size: 14px; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: #00ff88; }
        .btn { background: #00ff88; color: #000; border: none; padding: 12px 24px; border-radius: 6px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .btn:hover { background: #00dd77; transform: translateY(-1px); }
        .btn:disabled { background: #444; color: #888; cursor: not-allowed; transform: none; }
        .btn.secondary { background: #333; color: #fff; }
        .btn.secondary:hover { background: #444; }
        .status-card { background: linear-gradient(135deg, #1a3a1a, #2a4a2a); border-color: #00ff88; }
        .status-indicator { display: flex; align-items: center; gap: 8px; margin-bottom: 10px; }
        .status-dot { width: 8px; height: 8px; background: #00ff88; border-radius: 50%; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .wallets-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 12px; margin-top: 16px; }
        .wallet-item { background: #2a2a2a; padding: 12px; border-radius: 6px; border: 1px solid #444; }
        .wallet-address { font-family: monospace; font-size: 0.8rem; color: #888; margin-bottom: 4px; word-break: break-all; }
        .wallet-balance { color: #00ff88; font-weight: 600; }
        .results-area { background: #1a1a1a; border: 1px solid #333; border-radius: 12px; padding: 24px; margin-top: 20px; }
        .results-area h3 { color: #00ff88; margin-bottom: 16px; }
        .transaction-item { background: #2a2a2a; padding: 16px; border-radius: 8px; margin-bottom: 12px; border-left: 4px solid #00ff88; }
        .transaction-header { display: flex; justify-content: between; align-items: center; margin-bottom: 8px; }
        .transaction-status { padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; font-weight: 600; }
        .status-confirmed { background: #00ff88; color: #000; }
        .status-failed { background: #ff4444; color: #fff; }
        .loading { text-align: center; padding: 40px; color: #888; }
        .spinner { border: 2px solid #333; border-top: 2px solid #00ff88; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; margin: 0 auto 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .alert { padding: 12px; border-radius: 6px; margin-bottom: 16px; }
        .alert-success { background: #1a3a1a; border: 1px solid #00ff88; color: #00ff88; }
        .alert-error { background: #3a1a1a; border: 1px solid #ff4444; color: #ff4444; }
        .hidden { display: none; }
        .stats { display: flex; justify-content: space-between; margin-bottom: 16px; }
        .stat-item { text-align: center; }
        .stat-value { font-size: 1.5rem; font-weight: bold; color: #00ff88; }
        .stat-label { font-size: 0.8rem; color: #888; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">ðŸ¦€ Proxima Solana Bundler</h1>
            <p class="subtitle">High-performance Rust-powered Solana transaction bundling</p>
        </div>

        <div id="alert-container"></div>

        <div class="grid">
            <!-- Status Card -->
            <div class="card status-card">
                <h3>ðŸ“Š Server Status</h3>
                <div class="status-indicator">
                    <div class="status-dot"></div>
                    <span id="connection-status">Checking connection...</span>
                </div>
                <p id="server-info">Rust-powered Solana bundling service</p>
                
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-value" id="wallet-count">0</div>
                        <div class="stat-label">Wallets</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="bundle-count">0</div>
                        <div class="stat-label">Bundles</div>
                    </div>
                </div>
            </div>

            <!-- Wallet Management -->
            <div class="card">
                <h3>ðŸ‘› Wallet Management</h3>
                <div class="form-group">
                    <label for="wallet-count-input">Number of Wallets</label>
                    <input type="number" id="wallet-count-input" min="1" max="100" value="5">
                </div>
                <button class="btn" id="generate-wallets-btn" onclick="generateWallets()">
                    Generate Wallets
                </button>
                <button class="btn secondary" id="fund-wallets-btn" onclick="fundWallets()" disabled>
                    Fund Wallets (0.1 SOL)
                </button>
                
                <div id="wallets-container" class="hidden">
                    <h4 style="margin: 16px 0 8px 0; color: #ccc;">Generated Wallets</h4>
                    <div id="wallets-list" class="wallets-grid"></div>
                </div>
            </div>
        </div>

        <!-- Bundle Execution -->
        <div class="card">
            <h3>ðŸš€ Bundle Execution</h3>
            <div class="grid">
                <div class="form-group">
                    <label for="bundle-type">Bundle Type</label>
                    <select id="bundle-type">
                        <option value="buy">Multi-Wallet Buy</option>
                        <option value="sell">Multi-Wallet Sell</option>
                        <option value="distribute">Token Distribution</option>
                        <option value="volume">Volume Generation</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="amount-per-wallet">Amount per Wallet (SOL)</label>
                    <input type="number" id="amount-per-wallet" step="0.01" min="0.01" value="0.1">
                </div>
                <div class="form-group">
                    <label for="priority-fee">Priority Fee (SOL)</label>
                    <input type="number" id="priority-fee" step="0.001" min="0" value="0.001">
                </div>
                <div class="form-group">
                    <label for="slippage">Slippage (%)</label>
                    <input type="number" id="slippage" step="0.1" min="0.1" max="50" value="5">
                </div>
                <div class="form-group">
                    <label for="stagger-delay">Stagger Delay (ms)</label>
                    <input type="number" id="stagger-delay" min="0" max="5000" value="100">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="stealth-mode" checked> Stealth Mode
                    </label>
                    <label>
                        <input type="checkbox" id="mev-protection" checked> MEV Protection
                    </label>
                </div>
            </div>
            <button class="btn" id="execute-bundle-btn" onclick="executeBundle()" disabled>
                Execute Bundle
            </button>
        </div>

        <!-- Results -->
        <div class="results-area">
            <h3>ðŸ“ˆ Bundle Results</h3>
            <div id="results-container">
                <div class="loading">
                    <p>No bundles executed yet. Generate wallets and execute a bundle to see results.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let wallets = [];
        let bundleResults = [];

        // Check server connection on load
        window.addEventListener('load', checkServerConnection);

        async function checkServerConnection() {
            try {
                const response = await fetch('/api/health');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('connection-status').textContent = 'Connected to ' + data.data.network;
                    document.getElementById('server-info').textContent = data.data.server;
                } else {
                    throw new Error('Server health check failed');
                }
            } catch (error) {
                document.getElementById('connection-status').textContent = 'Connection failed';
                showAlert('Failed to connect to server: ' + error.message, 'error');
            }
        }

        async function generateWallets() {
            const count = parseInt(document.getElementById('wallet-count-input').value);
            const btn = document.getElementById('generate-wallets-btn');
            
            if (count < 1 || count > 100) {
                showAlert('Please enter a valid number of wallets (1-100)', 'error');
                return;
            }

            btn.disabled = true;
            btn.textContent = 'Generating...';

            try {
                const response = await fetch('/api/wallets/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ count })
                });

                const data = await response.json();

                if (data.success) {
                    wallets = data.data;
                    displayWallets();
                    document.getElementById('fund-wallets-btn').disabled = false;
                    document.getElementById('wallet-count').textContent = wallets.length;
                    showAlert(`Successfully generated ${count} wallets!`, 'success');
                } else {
                    throw new Error(data.error || 'Failed to generate wallets');
                }
            } catch (error) {
                showAlert('Error generating wallets: ' + error.message, 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = 'Generate Wallets';
            }
        }

        async function fundWallets() {
            if (wallets.length === 0) {
                showAlert('No wallets to fund. Generate wallets first.', 'error');
                return;
            }

            const btn = document.getElementById('fund-wallets-btn');
            btn.disabled = true;
            btn.textContent = 'Funding...';

            try {
                const walletAddresses = wallets.map(w => w.public_key);
                const response = await fetch('/api/wallets/fund', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ wallets: walletAddresses, amount: 0.1 })
                });

                const data = await response.json();

                if (data.success) {
                    wallets = data.data;
                    displayWallets();
                    document.getElementById('execute-bundle-btn').disabled = false;
                    showAlert(`Successfully funded ${wallets.length} wallets!`, 'success');
                } else {
                    throw new Error(data.error || 'Failed to fund wallets');
                }
            } catch (error) {
                showAlert('Error funding wallets: ' + error.message, 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = 'Fund Wallets (0.1 SOL)';
            }
        }

        async function executeBundle() {
            if (wallets.length === 0) {
                showAlert('No wallets available. Generate and fund wallets first.', 'error');
                return;
            }

            const btn = document.getElementById('execute-bundle-btn');
            btn.disabled = true;
            btn.textContent = 'Executing...';

            try {
                const bundleRequest = {
                    bundle_type: document.getElementById('bundle-type').value,
                    token_address: null,
                    amount_per_wallet: parseFloat(document.getElementById('amount-per-wallet').value),
                    wallets: wallets.map(w => w.public_key),
                    settings: {
                        priority_fee: parseFloat(document.getElementById('priority-fee').value),
                        slippage: parseFloat(document.getElementById('slippage').value),
                        stagger_delay: parseInt(document.getElementById('stagger-delay').value),
                        stealth_mode: document.getElementById('stealth-mode').checked,
                        mev_protection: document.getElementById('mev-protection').checked
                    }
                };

                const response = await fetch('/api/bundle/execute', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(bundleRequest)
                });

                const data = await response.json();

                if (data.success) {
                    bundleResults.unshift(data.data);
                    displayResults();
                    document.getElementById('bundle-count').textContent = bundleResults.length;
                    showAlert(`Bundle executed successfully! ${data.data.success_count}/${data.data.total_transactions} transactions succeeded.`, 'success');
                } else {
                    throw new Error(data.error || 'Failed to execute bundle');
                }
            } catch (error) {
                showAlert('Error executing bundle: ' + error.message, 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = 'Execute Bundle';
            }
        }

        function displayWallets() {
            const container = document.getElementById('wallets-container');
            const list = document.getElementById('wallets-list');
            
            container.classList.remove('hidden');
            list.innerHTML = wallets.map(wallet => `
                <div class="wallet-item">
                    <div class="wallet-address">${wallet.public_key}</div>
                    <div class="wallet-balance">${wallet.balance.toFixed(4)} SOL</div>
                </div>
            `).join('');
        }

        function displayResults() {
            const container = document.getElementById('results-container');
            
            if (bundleResults.length === 0) {
                container.innerHTML = '<div class="loading"><p>No bundles executed yet.</p></div>';
                return;
            }

            container.innerHTML = bundleResults.map(bundle => `
                <div class="transaction-item">
                    <div class="transaction-header">
                        <h4>Bundle ${bundle.bundle_id.substring(0, 8)}... (${bundle.bundle_type})</h4>
                        <span class="transaction-status status-confirmed">${bundle.success_count}/${bundle.total_transactions} Success</span>
                    </div>
                    <p><strong>Execution Time:</strong> ${bundle.execution_time_ms}ms</p>
                    <p><strong>Total Cost:</strong> ${bundle.total_cost.toFixed(6)} SOL</p>
                    <p><strong>Timestamp:</strong> ${new Date(bundle.timestamp).toLocaleString()}</p>
                    <details>
                        <summary>View Transactions (${bundle.transactions.length})</summary>
                        <div style="margin-top: 10px;">
                            ${bundle.transactions.map(tx => `
                                <div style="background: #333; padding: 8px; border-radius: 4px; margin: 4px 0;">
                                    <div><strong>Wallet:</strong> ${tx.wallet.substring(0, 8)}...</div>
                                    <div><strong>Status:</strong> <span class="transaction-status ${tx.status === 'confirmed' ? 'status-confirmed' : 'status-failed'}">${tx.status}</span></div>
                                    <div><strong>Amount:</strong> ${tx.amount.toFixed(4)} SOL</div>
                                    ${tx.signature ? `<div><strong>Signature:</strong> ${tx.signature.substring(0, 16)}...</div>` : ''}
                                    ${tx.error ? `<div style="color: #ff4444;"><strong>Error:</strong> ${tx.error}</div>` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </details>
                </div>
            `).join('');
        }

        function showAlert(message, type) {
            const container = document.getElementById('alert-container');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            
            container.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }
    </script>
</body>
</html>